# æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®ç°ï¼ˆæœ¬åœ°å­˜å‚¨ & é˜¿é‡Œäº‘ OSSï¼‰

åœ¨å¼€å‘åå°ç®¡ç†ç³»ç»Ÿæ—¶ï¼Œå›¾ç‰‡æˆ–æ–‡ä»¶ä¸Šä¼ æ˜¯å¸¸è§éœ€æ±‚ã€‚ä¸‹é¢ä»‹ç»ä¸¤ç§å®ç°æ–¹å¼ï¼š

---

## 1ï¸âƒ£ æœ¬åœ°æ–‡ä»¶å­˜å‚¨æ–¹å¼

**åç«¯æ¥å£ï¼š**

```xml
@PostMapping("/upload")
public Result upload(String username, Integer age, MultipartFile image) throws Exception {
    log.info("ä¸Šä¼ æ–‡ä»¶ï¼Œå‚æ•°ï¼šusername={}, age={}, file={}", username, age, image);

    // è·å–åŸå§‹æ–‡ä»¶å
    String originalFilename = image.getOriginalFilename();

    // æ‹¼æ¥æ–°çš„æ–‡ä»¶åï¼ˆUUID + åç¼€åï¼‰
    String newFileName = UUID.randomUUID().toString() + originalFilename.substring(originalFilename.lastIndexOf("."));
    log.info("æ–°æ–‡ä»¶åï¼š{}", newFileName);

    // å°†æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šç›®å½•ï¼ˆæ³¨æ„è·¯å¾„ç»“å°¾è¦åŠ  \ æˆ– /ï¼‰
    image.transferTo(new File("E:\\Code\\Java\\tlias-web-management\\images\\" + newFileName));

    return Result.success();
}
```
ğŸ“Œæ³¨æ„ï¼š

è·¯å¾„ä¸­çš„ images\\ æœ€å¥½åŠ æ–œæ ï¼ˆé¿å…æ–‡ä»¶åæ‹¼æ¥é”™è¯¯ï¼‰

ç¡®ä¿è¯¥ç›®å½•å­˜åœ¨å¹¶æœ‰å†™æƒé™

å®é™…éƒ¨ç½²æ—¶ï¼Œä¸æ¨èç›´æ¥å°†æ–‡ä»¶ä¿å­˜åœ¨ä»£ç ç›®å½•ä¸­ï¼Œå»ºè®®é…ç½®ä¸ºå¤–éƒ¨è·¯å¾„

## 2ï¸âƒ£ ä½¿ç”¨é˜¿é‡Œäº‘ OSS å®ç°æ–‡ä»¶ä¸Šä¼ 
âœ… UploadController
```xml
@RestController
public class UploadController {

    @Autowired
    private AliOSSUtils aliOSSUtils;

    @PostMapping("/upload")
    public Result upload(MultipartFile image) throws Exception {
        log.info("ä¸Šä¼ æ–‡ä»¶ï¼Œå‚æ•°ï¼šimage={}", image.getOriginalFilename());

        // ä¸Šä¼ æ–‡ä»¶å¹¶è·å– OSS è¿”å›çš„ URL
        String url = aliOSSUtils.upload(image);
        log.info("æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œè®¿é—®è·¯å¾„ï¼š{}", url);

        return Result.success(url);
    }
}
```
## âœ… AliOSSUtils å·¥å…·ç±»
```xml
@Component
public class AliOSSUtils {

    private String endpoint = "https://oss-cn-hangzhou.aliyuncs.com";
    private String accessKeyId = "ä½ çš„AccessKeyId";
    private String accessKeySecret = "ä½ çš„AccessKeySecret";
    private String bucketName = "ä½ çš„Bucketåç§°";

    public String upload(MultipartFile file) throws Exception {
        // è·å–ä¸Šä¼ æ–‡ä»¶çš„è¾“å…¥æµ
        InputStream inputStream = file.getInputStream();

        // é¿å…æ–‡ä»¶åé‡å¤
        String originalFilename = file.getOriginalFilename();
        String fileName = UUID.randomUUID().toString() + originalFilename.substring(originalFilename.lastIndexOf("."));

        // åˆ›å»º OSS å®¢æˆ·ç«¯å®ä¾‹
        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);

        // ä¸Šä¼ æ–‡ä»¶
        ossClient.putObject(bucketName, fileName, inputStream);

        // æ‹¼æ¥è®¿é—®åœ°å€
        String url = endpoint.split("//")[0] + "//" + bucketName + "." + endpoint.split("//")[1] + "/" + fileName;

        // å…³é—­å®¢æˆ·ç«¯
        ossClient.shutdown();
        return url;
    }
}
```
ğŸ“Œæ³¨æ„ï¼š

ä½ çš„ AccessKey å’Œ Secret è¦åšå¥½è„±æ•å¤„ç†ï¼Œæ­£å¼é¡¹ç›®å»ºè®®ç”¨é…ç½®æ–‡ä»¶æ³¨å…¥

ä¸Šä¼ åçš„ url å¯ç›´æ¥ç”¨äºç½‘é¡µè®¿é—®ï¼ˆå‰ææ˜¯ Bucket æƒé™è®¾ç½®ä¸ºå…¬å¼€è¯»ï¼‰

å¯æ ¹æ®é¡¹ç›®å°è£… OSS ä¸Šä¼ æœåŠ¡ç±»ï¼Œå¤ç”¨æ›´æ–¹ä¾¿
## âœ… æ€»ç»“å¯¹æ¯”

| æ–¹å¼      | ä¼˜ç‚¹            | ç¼ºç‚¹             |
| ------- | ------------- | -------------- |
| æœ¬åœ°å­˜å‚¨    | å®ç°ç®€å•ã€æ— éœ€é¢å¤–è´¦å·   | éƒ¨ç½²ä¸çµæ´»ï¼Œæ–‡ä»¶ä¸æ˜“ç»Ÿä¸€ç®¡ç† |
| é˜¿é‡Œäº‘ OSS | æ–‡ä»¶ç»Ÿä¸€å­˜å‚¨ã€æ”¯æŒå…¬ç½‘è®¿é—® | éœ€è¦å¼€é€šæœåŠ¡ã€å­˜åœ¨ä¸€å®šè´¹ç”¨  |
